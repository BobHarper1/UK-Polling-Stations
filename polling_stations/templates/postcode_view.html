{% extends "base.html" %}
{% load static %}

{% block extra_page_css %}
<link rel="stylesheet" href="{% static "css/map.css" %}" />
{% endblock extra_page_css %}

{% block content %}

<div class="row">
  <div class="columns large-8">
    <div class="card">
      <h2>
        {% if we_know_where_you_should_vote %}
          Your polling station
        {% endif %}
        {% if only_polling_stations or only_polling_districts or no_data %}
          Contact {{ council.name }} to find out where you should vote
        {% endif %}
      </h2>

      {% if we_know_where_you_should_vote %}
        <address>
          {{ points.0.address|linebreaksbr }}<br>
          {% if points.0.postcode %}
            {% if not points.0.postcode in points.0.address %}
              {{ points.0.postcode }}
            {% endif %}
          {% endif %}
        </address>
        {% if directions.routes.0.legs.0.duration.text %}
        <div id="directions">
          <a href="https://www.google.com/maps/dir/{{postcode}}/{{ points.0.location.y }},{{ points.0.location.x }}">
            About {{ directions.routes.0.legs.0.duration.text }} walk
            ({{ directions.routes.0.legs.0.distance.text }})</a>
        </div>
        {% endif %}
      {% endif %}


      {% if only_polling_stations or only_polling_districts or no_data %}
        <p class="lead">
          Phone {{ council.name }}:
          <a href="tel:{{ council.phone }}">{{ council.phone }}</a>
        </p>
        <p class="lead">And ask them:</p>
        <ul class="lead">
          <li>
            Where your polling station is (you'll need to give them your full
            address)
          </li>
          <li>
            If they will help make this information available online in the future
            by helping this project (say you came from this site)
          </li>
        </ul>
      {% endif %}

      <div id="area_map" class="card_inset">asd</div>


    </div>

  </div>


  <div class="columns large-4">
    <div class="card">
        <h3>You don't need your poll card to vote</h3>
        <p>If you don't have your polling card, you can just go to the polling
            station and give them your name and address.</p>
        <p>You don't need any other form of ID.</p>
    </div>


    <div class="card">
      <h3>Council Contact info</h3>
      <address>
        {{ council.address|linebreaksbr }}<br>
        {{ council.postcode }}<br><br>
        <abbr title="Phone">P:</abbr> <a href="tel:{{ council.phone }}">{{ council.phone }}</a><br>
        <abbr title="Email">E:</abbr>
        <a href="mailto:{{ council.email }}">{{ council.email }}</a>
      </address>
    </div>

  </div>
</div>
{% endblock content %}

{% block in_page_javascript %}
  <style>
    .council_location_icon {
    background-color:black;
    border-radius: 50%;
    height:2px;
    width:2px;
    }
  </style>
  <script>

    // Maps
    window.create_area_map = function(point, feature) {
    var area = L.geoJson(feature);
    // var council_location = L.geoJson(point);
    var council_location = point;
    var b = area.getBounds();

    var map = L.map('area_map', {zoomControl:true}).setView(b.getCenter(), 8);
    // map.dragging.disable();
    // map.touchZoom.disable();
    // map.doubleClickZoom.disable();
    map.scrollWheelZoom.disable();

    map.setView(new L.LatLng(51.3, 0.7),10);
    map.fitBounds(map.fitBounds(b));
    // map.addLayer(osm);

    L.tileLayer('http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: 'Map data Â© <a href="http://openstreetmap.org">OpenStreetMap</a> contributors'
    }).addTo(map);

    window.map = map;
    map.setZoom(15)

    // area.addTo(map);

    {% for station in points %}
      L.marker([{{ station.location.1 }}, {{ station.location.0 }}], {
      'clickable': true,
      }).addTo(map);
    {% endfor %}


  }

    var point = [{{ location.1 }}, {{ location.0 }}];

    {% if areas.polling_district %}
      var feature = {{ areas.polling_district.area.geojson|safe }};
    {% endif %}

    {% if not has_polling_district %}
      var feature = {{ areas.council.area.geojson|safe }};
    {% endif %}

    // fallback.ready(['L'], function() {
        create_area_map(point, feature);
    // });

  </script>
{% endblock in_page_javascript %}


{% block extra_javascript %}
<script src="{% static "js/leaflet.js" %}"></script>
{% endblock extra_javascript %}
